<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="icon" id="favicon" href="favicon/1.png">
    <title>New Tab</title>
    <style>
 html, body {
     height: 100%;
     margin: 0;
     padding: 0;
     overflow: hidden;
}
 body {
     background-color: #0e0e0e; /* Green */
     display: flex;
     justify-content: center;
     align-items: center;
     font-family: "Montserrat", sans-serif;
     overflow: hidden;
}
 .contents {
     text-align: center;
     color: white;
     font-family: "Montserrat", sans-serif;
}
 .nothing {
     border: none;
     background-color: transparent;
     color: #0e0e0e;
     font-family: "Montserrat", sans-serif;
}
 input:focus, select:focus, textarea:focus, button:focus {
     outline: none;
}
.permoutput {
    font-size: 150%; 
    color: gray; 
    left: 25px;
    position: absolute;
    left: 30%;
    top: 30%;
}

    </style>
  </head>
  <body>
   <div class="contents">
<div style="font-size: 150%; color: gray; left: 25px;" id="permoutputshower"></div><br>
<div style="font-size: 150%; left: 25px;" id="textshower"></div><br>
<div style="font-size: 150%; color: gray; left: 25px;" id="outputshower"></div>
<input type="text" spellcheck="false" onkeypress="updatetext()" onkeyup="updatetext()" onkeydown="updatetext()" class="nothing" id="writtenstuff"></input>
    </div>
    <script>
// can anyone that forked this tell me whether this code is bad because i am not good at this
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
let displayingtext = false;
let engine = 1;
if (localStorage.default) {
    engine = parseInt(localStorage.default);
}
const written = document.getElementById("writtenstuff");
const textshow = document.getElementById("outputshower");
if (localStorage.keywords == undefined) {
    const keywords = [];
    localStorage.setItem("keywords", JSON.stringify(keywords));
}
if (localStorage.engines == undefined) {
    const google = ["google", "https://www.google.com/search?q=%s"];
    const ddg = ["duckduckgo", "https://duckduckgo.com/?q=%s"];
    const bing = ["bing", "https://www.bing.com/search?q=%s"];
    const engines = [JSON.stringify(google), JSON.stringify(ddg), JSON.stringify(bing)];
    localStorage.setItem("engines", JSON.stringify(engines));
}
if (localStorage.colors == undefined) {
    const colors = ["#0e0e0e", "white", "gray"];
    localStorage.setItem("colors", JSON.stringify(colors));
}
if (localStorage.permoutput == undefined) {
    localStorage.setItem("permoutput", "")
}
document.addEventListener("visibilitychange", function() {
    written.value = "‎";
    document.getElementById("textshower").innerText = "";
    textshow.innerHTML = "";
});
if (written.value == "") {
    written.value = "‎";
}
const engines = JSON.parse(localStorage.engines);
const keywords = JSON.parse(localStorage.keywords);
const colors = JSON.parse(localStorage.colors);
written.style.color = colors[0];
document.body.style.backgroundColor = colors[0];
document.getElementById("textshower").style.color = colors[1];
document.getElementById("outputshower").style.color = colors[2];
document.getElementById("permoutputshower").style.color = colors[2];
document.addEventListener("onclick", function() {
    written.focus();
})
written.focus();
function resetpermoutput() {
if (localStorage.permoutput != "nothing") {
    document.getElementById("permoutputshower").innerHTML = "";
    checkforoutputcommand(localStorage.permoutput, document.getElementById("permoutputshower"));
} else {
    document.getElementById("permoutputshower").innerHTML = "";
}
}
resetpermoutput();

async function search() {
    if (written.value.substring(0, 1) == "‎" || written.value.substring(0, 1) == " ") { // this fixes a problem with commands not registering for the first time
        written.value = written.value.substring(1, written.value.length);
    }
    if (written.value.substring(0, 7) == "ignore " || written.value.substring(0, 2) == "i ") { //ignore 
        const enginedatas = JSON.parse(engines[engine]);
        if (written.value.substring(0, 7) == "ignore ") {
            window.location.href = enginedatas[1].replace("%s", written.value.substring(7, written.value.length));
        } else {
            window.location.href = enginedatas[1].replace("%s", written.value.substring(2, written.value.length));
        }
        return;
    }
    if (written.value.substring(0, 8) == "default ") { // default
        for (let i = 0; i < engines.length; i++) {
            const enginedata = JSON.parse(engines[i]);
            if (written.value.substring(8, written.value.length) == enginedata[0]) {
                localStorage.setItem("default", i);
                written.value = "";
                document.getElementById("textshower").innerText = "";
                return;
            }
        }
    }
    for (let i = 0; i < keywords.length; i++) { // keyword
        const keyworddata = JSON.parse(keywords[i]);
        if (written.value == keyworddata[0]) {
            window.location.href = keyworddata[1];
            return;
        }
    }
    for (let i = 0; i < engines.length; i++) { // change engine
        const enginedata = JSON.parse(engines[i]);
        if (written.value == enginedata[0]) {
            engine = i;
            written.value = "";
            return;
        }
    }
    for (let i = 0; i < engines.length; i++) { // engine query
        const enginedata = JSON.parse(engines[i]);
        const writtennow = written.value.split(" ");
        let query = "";
        if (written.value.split(" ")[0] == enginedata[0] && written.value.split(" ").length > 1) {
            engine = i;
            for (let i = 1; i < writtennow.length; i++) {
                query += writtennow[i] + " ";
            }
            window.location.href = enginedata[1].replace("%s", query.substring(0, query.length - 1));
            return;
        }
    }
    if (written.value == "permoutput") {
        written.value = "";
        localStorage.setItem("permoutput", "nothing");
        resetpermoutput();
        return;
    }
    if (written.value.substring(0, 11) == "permoutput ") { // change perm output
        localStorage.setItem("permoutput", written.value.substring(11, written.value.length));
        resetpermoutput();
        written.value = "";
        return;
    }
    if (written.value.substring(0, 12) == "add keyword ") { // add keyword
        keywords.push(JSON.stringify(written.value.substring(12, written.value.length).split(" ")));
        localStorage.setItem("keywords", JSON.stringify(keywords));
        resetpermoutput();
        written.value = "";
        return;
    }
    if (written.value.substring(0, 15) == "remove keyword ") { // remove keyword
        for (let i = 0; i < keywords.length; i++) {
            const keyworddata = JSON.parse(keywords[i]);
            if (keyworddata.includes(written.value.substring(15, written.value.length))) {
                keywords.splice(i, 1);
                written.value = "";
                resetpermoutput();
                localStorage.setItem("keywords", JSON.stringify(keywords));
                return;
            }
        }
    }
    if (written.value.substring(0, 13) == "edit keyword ") { // edit keyword
        let data = written.value.substring(13, written.value.length).split(" ")
        written.value = "remove keyword " + data[0]
        search();
        await sleep(10);
        written.value = "add keyword " + data[0] + " " + data[1]
        search();
        return;
    }
    if (written.value.substring(0, 14) == "remove engine ") { // remove engine
        for (let i = 0; i < engines.length; i++) {
            const enginedata = JSON.parse(engines[i]);
            if (enginedata.includes(written.value.substring(14, written.value.length))) {
                resetpermoutput();
                engines.splice(i, 1);
                written.value = "";
                localStorage.setItem("engines", JSON.stringify(engines));
                return;
            }
        }
    }
    if (written.value.substring(0, 11) == "add engine ") { // add engine
        engines.push(JSON.stringify(written.value.substring(11, written.value.length).split(" ")));
        localStorage.setItem("engines", JSON.stringify(engines));
        resetpermoutput();
        written.value = "";
        return;
    }
    if (written.value.substring(0, 12) == "edit engine ") { // edit keyword
        let data = written.value.substring(12, written.value.length).split(" ")
        written.value = "remove engine " + data[0]
        search();
        await sleep(10);
        written.value = "add engine " + data[0] + " " + data[1]
        search();
        return;
    }
    if (written.value.substring(0, 4) == "web ") { // web
        window.location.href = "https://" + written.value.substring(4, written.value.length);
        written.value = "";
        return;
    }
    if (written.value.substring(0, 3) == "bg ") { // bg color
        resetpermoutput();
        if (written.value == "bg default") {
            document.body.style.backgroundColor = written.value.substring(3, written.value.length);
            written.style.color = "#0e0e0e";
            colors[0] = "#0e0e0e"
            localStorage.setItem("colors", JSON.stringify(colors));
            written.value = "";
            return;
        }
        document.body.style.backgroundColor = written.value.substring(3, written.value.length);
        written.style.color = written.value.substring(3, written.value.length);
        colors[0] = written.value.substring(3, written.value.length);
        localStorage.setItem("colors", JSON.stringify(colors));
        written.value = "";
        return;
    }
    if (written.value.substring(0, 5) == "text ") { // text color
        resetpermoutput();
        if (written.value == "text default") {
            document.getElementById("textshower").style.color = "white"
            colors[1] = "white";
            localStorage.setItem("colors", JSON.stringify(colors));
            written.value = "";
            return;
        }
        document.getElementById("textshower").style.color = written.value.substring(5, written.value.length);
        colors[1] = written.value.substring(5, written.value.length);
        localStorage.setItem("colors", JSON.stringify(colors));
        written.value = "";
        return;
    }
    if (written.value.substring(0, 7) == "output ") { // output color
        resetpermoutput();
        if (written.value == "output default") {
            document.getElementById("outputshower").style.color = "gray";
            colors[2] = "gray";
            localStorage.setItem("colors", JSON.stringify(colors));
            written.value = "";
            return;
        }
        document.getElementById("outputshower").style.color = written.value.substring(7, written.value.length);
        colors[2] = written.value.substring(7, written.value.length);
        localStorage.setItem("colors", JSON.stringify(colors));
        written.value = "";
        return;
    }
    // fallback if no commands
    const enginedata = JSON.parse(engines[engine]);
    window.location.href = enginedata[1].replace("%s", written.value);
}
document.addEventListener("keydown", function(event) {
    document.getElementById("writtenstuff").focus();
    if (event.key === "Enter" && displayingtext == false) {
        event.preventDefault();
        search();
    }
    if (displayingtext == true) {
        displayingtext = false;
        written.value = "";
        return;
    }
});

function checkforoutputcommand(input, output) {
    if (input.substring(0, 1) == "‎" || input.substring(0, 1) == " ") { // same thing as in the search command
        input = input.substring(1, input.length)
    }
    if (input == "engines" || input == "e") {
        for (let i = 0; i < engines.length; i++) {
            const enginedata2 = JSON.parse(engines[i]);
            if (i == engines.length - 1) {
                output.innerHTML += " " + enginedata2[0];
            } else {
                output.innerHTML += " " + enginedata2[0] + ",";
            }
        }
        return;
    }
    if (input == "keywords" || input == "k") {
        for (let i = 0; i < keywords.length; i++) {
            keyworddata = JSON.parse(keywords[i]);
            if (i == keywords.length - 1) {
                output.innerHTML += " " + keyworddata[0];
            } else {
                output.innerHTML += " " + keyworddata[0] + ",";
            }
        }
        return;
    }
    if (input == "colors" || input == "c") {
        for (let i = 0; i < colors.length; i++) {
            colordata = colors[i];
            if (i == colors.length - 1) {
                output.innerHTML += " " + colordata;
            } else {
                output.innerHTML += " " + colordata + ",";
            }
        }
        return;
    }
    if (input == "help" || input == "help ") {
        output.innerHTML = "Specify a category that is keywords, engines, colors or other";
    }
    if (input.substring(0, 5) == "help ") {
        const substring = input.substring(5, input.length)
        if (substring == "keywords") {
            output.innerHTML = "add keyword [keyword] [link] - add a keyword<br>remove keyword [keyword] - remove a keyword<br>edit keyword [keyword] [link] - edit a keyword<br>keywords (or e) - see all available keywords<br>[keyword] - use a keyword";
            return;
        }
        if (substring == "engines") {
            output.innerHTML = "add engine [search engine] [link with %s in place of the query] - add a search engine<br>remove engine [search engine] - remove a search engine<br>edit engine [search engine] [link with %s in place of the query] - edit an engine<br>default [engine] - set your default search engine<br>[engine] [query] - search with a search engine<br>[engine] - switch your current search engine<br>engines (or e) - see all available search engines";
            return;
        }
        if (substring == "colors") {
            output.innerHTML = "text/bg/output [css color name or hex code] - change the text, background or command output color<br>text/bg/output default - set the text, background or command output color to the default<br>colors (or c) - see all set colors";
            return;
        }
        if (substring == "other") {
            output.innerHTML = "web [website domain] - go to a website<br>ignore (or i) [query] - search the query and ignore all commands<br>permoutput [command] - change what is shown on the permanent output (must be a command that gives an output, write just permoutput to show nothing)";
            return;
        } else {
            if (input != "help ") {
                output.innerHTML = "Category doesn't exist"
            }
        }
    }
}
async function updatetext() {
    document.getElementById("textshower").innerText = written.value.slice(0, written.selectionStart) + "|" + written.value.slice(written.selectionStart);
    document.getElementById("outputshower").innerText = "";
    if (written.value == "") {
    written.value = "‎";
}
    checkforoutputcommand(written.value, document.getElementById("outputshower"));
}
const favicon = document.getElementById("favicon");
async function insertcursor() {
    const cursorposition = written.selectionStart;
    document.getElementById("textshower").innerText = written.value.slice(0, cursorposition) + "|" + written.value.slice(cursorposition);
    favicon.href = "favicon/1.png";
    await sleep(450);
    favicon.href = "favicon/2.png";
    await sleep(50)
    document.getElementById("textshower").innerText = written.value;
    setTimeout(insertcursor, 450);
}
insertcursor();
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const query = urlParams.get("q");
if (query != null) {
    written.value = urlParams.get("q");
    search();
    written.value = "‎";
}

async function testcommands() {
    written.value = "help";
    updatetext();
    await sleep(500);
    written.value = "help keywords";
    updatetext();
    await sleep(500);
    written.value = "help engines";
    updatetext();
    await sleep(500);
    written.value = "help other";
    updatetext();
    await sleep(500);
    written.value = "engines";
    updatetext();
    await sleep(500);
    written.value = "keywords";
    updatetext();
    await sleep(500);
    written.value = "colors";
    updatetext();
    await sleep(500);
    written.value = "add keyword test";
    updatetext();
    search();
    if (JSON.stringify(keywords).includes("test") == false) {
        document.getElementById("outputshower").innerText = "Failed add keyword";
        return;
    } else {
        document.getElementById("outputshower").innerText = "Add keyword success";
    }
    await sleep(500);
    written.value = "remove keyword test";
    updatetext();
    search();
    if (JSON.stringify(keywords).includes("test")) {
        document.getElementById("outputshower").innerText = "Failed remove keyword";
        return;
    } else {
        document.getElementById("outputshower").innerText = "Remove keyword success";
    }
    await sleep(500);
    written.value = "add engine test";
    updatetext();
    search();
    if (JSON.stringify(engines).includes("test") == false) {
        document.getElementById("outputshower").innerText = "Failed add engine";
        return;
    } else {
        document.getElementById("outputshower").innerText = "Add engine success";
    }
    await sleep(500);
    written.value = "remove engine test";
    updatetext();
    search();
    if (JSON.stringify(engines).includes("test")) {
        document.getElementById("outputshower").innerText = "Failed remove engine";
        return;
    } else {
        document.getElementById("outputshower").innerText = "Remove engine success";
    }
    await sleep(1000);
    document.getElementById("outputshower").innerText = "";
}
    </script>
  </body>
</html>